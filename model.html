<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Visita VR</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <style>
    body { margin: 0; }
  </style>
</head>
<body>

<a-scene cursor="rayOrigin: mouse">
  <a-assets>

    <!-- Escenas -->
    <img id="scene-general" src="assets/imatges/0_general.jpg">
    <img id="scene-oficines" src="assets/imatges/1_oficines.jpg">
    <img id="scene-abocador" src="assets/imatges/2_abocador.jpg">
    <img id="scene-plantatransferencia" src="assets/imatges/3_plantatransferencia.jpg">
    <img id="scene-motorbiogas" src="assets/imatges/4_motorbiogas.jpg">
    <img id="scene-bassesdaigues" src="assets/imatges/5_bassesdaigues.jpg">
    <img id="scene-parcsolar" src="assets/imatges/6_parcsolar.jpg">
    <img id="scene-plantacompostatge" src="assets/imatges/7_plantacompostatge.jpg">
    <img id="scene-novaplanta" src="assets/imatges/8_novaplanta.jpg">

    <!-- plano y banderas -->
    <img id="dibuplano" src="assets/imatges/plano.jpg">
    <img id="bes" src="assets/imatges/bes.png">
    <img id="bcat" src="assets/imatges/bcat.png">
    <img id="buk" src="assets/imatges/buk.png">

  </a-assets>

  <!-- cÃ¡mara -->
  <a-entity camera look-controls wasd-controls="false"></a-entity>

  <!-- sky inicial -->
  <a-sky id="sky" src="#scene-general"></a-sky>

  <!-- banderas idioma -->
  <a-plane id="es" position="-1.6 -0.6 -2" src="#bes" scale="1 1 1"></a-plane>
  <a-plane id="cat" position="0 -0.6 -2" src="#bcat" scale="1 1 1"></a-plane>
  <a-plane id="uk" position="1.6 -0.6 -2" src="#buk" scale="1 1 1"></a-plane>

  <!-- mapa -->
  <a-plane id="plano"
           position="0 -1 -2"
           src="#dibuplano"
           scale="2 1 2"
           visible="false">
  </a-plane>

  <!-- esfera general -->
  <a-sphere id="hot-general"
            position="0 0 0"
            radius="0.08"
            color="blue"
            visible="false"
            animation="property: scale; dur: 1000; to: 1.2 1.2 1.2; dir: alternate; loop: true">
  </a-sphere>

  <!-- sonido -->
  <a-entity id="sound" sound="autoplay: false"></a-entity>

</a-scene>

<script>
  const sky = document.querySelector('#sky');
  const sound = document.querySelector('#sound');

  const banderaEs = document.querySelector('#es');
  const banderaCat = document.querySelector('#cat');
  const banderaUk = document.querySelector('#uk');

  const mapa = document.querySelector('#plano');
  const hotGeneral = document.querySelector('#hot-general');

  let idioma = "ca";

  // escenas
  const scenes = {
    general: '#scene-general',
    oficines: '#scene-oficines',
    abocador: '#scene-abocador',
    plantatransferencia: '#scene-plantatransferencia',
    motorbiogas: '#scene-motorbiogas',
    bassesdaigues: '#scene-bassesdaigues',
    parcsolar: '#scene-parcsolar',
    planta_compostatge: '#scene-plantacompostatge',
    nova_planta: '#scene-novaplanta'
  };

  // audios asociados
  const audioMap = {
    general: 'cetreria',
    oficines: 'oficina',
    abocador: 'vertedero',
    plantatransferencia: 'vidre_i_envasos',
    motorbiogas: 'biogas',
    bassesdaigues: 'aigues_pluvials',
    parcsolar: 'parc_solar',
    planta_compostatge: 'planta_compostatge',
    nova_planta: 'planta_valoritzacio'
  };

  function setScene(key, playAudioToo = true) {
    if (!scenes[key]) return;

    sky.setAttribute('src', scenes[key]);

    if (sound.components && sound.components.sound && sound.components.sound.isPlaying) {
      sound.components.sound.stopSound();
    }

    const audioNombre = audioMap[key];
    if (playAudioToo && audioNombre) {
      const ruta = `assets/audios/${idioma}/${audioNombre}.mp3`;
      sound.setAttribute('sound', `src: ${ruta}; autoplay: false`);

      setTimeout(() => {
        if (sound.components.sound) {
          sound.components.sound.playSound();
        }
      }, 100);
    }
  }

  function onSelectLanguage(lang) {
    idioma = lang;
    setScene('general', true);

    banderaEs.setAttribute('visible', false);
    banderaCat.setAttribute('visible', false);
    banderaUk.setAttribute('visible', false);

    mapa.setAttribute('visible', true);
    hotGeneral.setAttribute('visible', true);
  }

  // eventos banderas
  banderaEs.addEventListener('click', () => onSelectLanguage('es'));
  banderaCat.addEventListener('click', () => onSelectLanguage('ca'));
  banderaUk.addEventListener('click', () => onSelectLanguage('uk'));

  // evento esfera general
  hotGeneral.addEventListener('click', () => {
    setScene('general');
  });

  // desactivar movimiento WASD
  const cam = document.querySelector('[camera]');
  if (cam) cam.removeAttribute('wasd-controls');
</script>

</body>
</html>
